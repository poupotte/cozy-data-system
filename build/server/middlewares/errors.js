// Generated by CoffeeScript 1.8.0
var locker, logger;

locker = require('../lib/locker');

logger = require('printit')({
  date: true,
  prefix: 'app:error'
});

module.exports = function(err, req, res, next) {
  var message, statusCode;
  statusCode = err.status || 500;
  message = err instanceof Error ? err.message : err.error;
  res.send(statusCode, {
    error: message
  });
  if (err instanceof Error) {
    logger.error(err.message);
    logger.error(err.stack);
  }
  if (req.lock != null) {
    return locker.removeLock(req.lock);
  }
};
