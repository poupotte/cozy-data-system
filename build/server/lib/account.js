// Generated by CoffeeScript 1.8.0
var Account, db;

db = require('../helpers/db_connect_helper').db_connect();

module.exports = Account = (function() {
  function Account() {}

  Account.prototype.initAllView = function(callback) {
    return db.get("_design/accounts", (function(_this) {
      return function(err, res) {
        var design_doc, map;
        if (err && err.error === 'not_found') {
          map = function(doc) {
            if (doc.docType === "Account") {
              return emit(doc._id, doc);
            }
          };
          design_doc = {};
          design_doc.all = {
            map: map.toString()
          };
          return db.save("_design/accounts", design_doc, function(err, res) {
            if (err) {
              return callback(err);
            } else {
              return callback(null);
            }
          });
        } else {
          return callback(null);
        }
      };
    })(this));
  };

  Account.prototype.getAccounts = function(callback) {
    return this.initAllView(function(err) {
      if (err) {
        return callback(err);
      } else {
        return db.view('accounts/all', (function(_this) {
          return function(err, res) {
            if (err) {
              return callback(err);
            } else {
              if (res.length > 0) {
                return callback(null, res);
              } else {
                return callback(null, new Error("No user found"));
              }
            }
          };
        })(this));
      }
    });
  };

  return Account;

})();
